# Sprint 5.1 — Timesheet Export + File Attachments Design

## Timesheet Export (CSV/PDF)

**Architecture:** Server-side export via API route `GET /api/export/timesheet`. Accepts query params for format (`csv`/`pdf`), date range, and optional user filter. Returns a streamed file download.

- **CSV:** Native JavaScript string building (no library needed — timesheet data is flat/simple)
- **PDF:** `jspdf` + `jspdf-autotable` plugin for table layout. Includes workspace name, date range header, entries grouped by date, and summary totals at bottom
- **Permissions:** Members export own entries only. Admins/owners can export any member's or all entries
- **UI:** "Export" dropdown button on timesheet page with CSV/PDF options + date range already available from existing filters

## File Attachments

**Architecture:** Local filesystem storage under `public/uploads/{workspaceId}/{todoId}/` with a new `attachments` table in the DB tracking metadata.

- **Schema:** `attachments` table — `id`, `todo_id`, `user_id`, `workspace_id`, `file_name`, `file_key` (path), `file_size`, `mime_type`, `created_at`
- **Storage helper:** `lib/storage/index.ts` — `uploadFile()`, `getFileUrl()`, `deleteFile()` abstracting local filesystem (easy to swap to R2/S3 later)
- **Upload route:** `POST /api/upload` — multipart form data, validates file size/type, stores to disk, creates DB record
- **Plan limits:** Add `max_storage_mb` to plans schema (Solo: 100MB, Team: 1GB, Agency: 10GB). Check total workspace storage before upload
- **UI:** File upload button on todo detail, file list with download/delete
- **Allowed types:** Images (png, jpg, gif, webp), documents (pdf, doc, docx, xls, xlsx, txt), max 10MB per file
